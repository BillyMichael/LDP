gitea:
  ingress:
    enabled: true
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      cert-manager.io/cluster-issuer: ca-issuer
    hosts:
      - host: vcs-127-0-0-1.nip.io
    tls:
      - secretName: gitea-server-tls
        hosts:
          - vcs-127-0-0-1.nip.io

  service:
    DISABLE_REGISTRATION: true

  oauth2_client:
    ENABLE_AUTO_REGISTRATION: true

  gitea:
    oauth:
      - name: "Authelia"
        provider: "openidConnect"
        key: "gitea"
        secret: "insecure_secret"
        autoDiscoverUrl: "https://auth-127-0-0-1.nip.io/.well-known/openid-configuration"
        scopes:
          - "openid"
          - "profile"
          - "email"
          - "groups"

  valkey-cluster:
    enabled: false
  valkey:
    enabled: true

  postgresql-ha:
    enabled: false
  postgresql:
    enabled: true

  extraVolumes:
    - name: ca
      configMap:
        name: ca
    - name: ca-store
      emptyDir: {}
    - name: system-certs
      emptyDir: {}

  extraVolumeMounts:
    - name: ca-store
      mountPath: /usr/local/share/ca-certificates
    - name: system-certs
      mountPath: /etc/ssl/certs

  initContainers:
    - name: update-ca
      image: alpine:3.20
      command:
        - sh
        - -c
        - |
          # Copy the CA certificate to the shared volume
          cp /ca/trust-bundle.pem /usr/local/share/ca-certificates/ldp-ca.crt
          # Update CA certificates
          update-ca-certificates
          # Copy the updated cert bundle to shared volume for main container
          cp -r /etc/ssl/certs/* /system-certs/
      volumeMounts:
        - name: ca
          mountPath: /ca
        - name: ca-store
          mountPath: /usr/local/share/ca-certificates
        - name: system-certs
          mountPath: /system-certs